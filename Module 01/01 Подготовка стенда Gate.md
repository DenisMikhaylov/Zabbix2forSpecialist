---
Практическая работа:
    Название: 'Создание среды для практических работ.'
    Действие: 'Модуль первый'
    Задача: ' Настройка Gate'
---
# **Создание сервисов и сети предприятия**

В данной практической работе мы создадим стенд в рамках, которого будем выполнять наш курс .

Этапы создания стенда:

- Импорт виртуальных машин

- Настройка виртуальных машин и сети

- Развертывания сервисов

Имена пользователей и пароли:
```
Для denian
login: student 
password: 111
login: root 
password: 111
```
```
Для Windows
login: Student 
password: password
```
### **Практическая работа**

### **Задача 1: Импорт виртуальных машин**
Импортировать 4 виртуальные машины
```
3 Debian
Gate 
Server
DebianGUI
```
```
1 Windows
WinCli
```

Настройка Gate

### **Задача 2: Настройка виртуальных машин**

Gate предназначен для пограничного маршрутизатора и межсетевого экрана

Настройка Gate

Настройка системы виртуализации например в Oracle VM VirtualBox

Настрояка сетвых интерфейсов

1. На панели инструментов нажмите кнопку "Настроить".

2. В открывшемся окне слева выберите "Сеть".

3. С правой стороны перейдите на вкладки и настроить выбор согласно списку снизу.:
```
Адаптер 1 - Сетевой мост
Адаптер 2 - Виртуальный адаптер хоста 
```
4. На каждом адаптере нажмите на надпись "Дополнительно".

5. Нажать на кнопку с двумя синими стрелочками и перегенерировать MAC-адрес

6. Нажмите кнопку "OK".
   
8. На панели инструментов нажмите кнопку "Запустить".

9. Войдите в систему под учетной записью указанной сверху.

10. Запустите терминул.

11. Получите права супер пользователя.

```
student@debian:~$ su -
```
```
< Введите пароль пользователя student >
```

12. Настроить сетевые адреса
    
```
# nano /etc/network/interfaces
```
```
# WAN
auto enp0s3
iface enp0s3 inet dhcp


#LAN
auto enp0s8
iface enp0s8 inet static
address 192.168.10.1/24

```
13. Изменить имя компьютера
```
hostnamectl set-hostname  gate.corp.local
```
14. Откройте в текстовом редакторе файл /etc/hosts.

15. Замените вторую строку на
```
127.0.1.1 gate gate.corp.local
```

16. Перезапустить сетевые адаптеры
```
systemctl restart networking
```
17. Проверка IP адресации
```
ip a
ip r
```
18. Проверка связи
```
ping ya.ru
```


Подключаемся по ssh к серверу Gate под студентом

1. Получите права супер пользователя.

```
student@debian:~$ su -
```
```
< Введите пароль пользователя student >
```


2. Настройка маршрутизации

Настраиваем перенаправление ip
```
nano /etc/sysctl.conf
```
Правим строку
```
net.ipv4.ip_forward=1
```
Перечитаем конфигурацию
```
sysctl -f
```
Проверяем
```
sysctl net.ipv4.ip_forward
```
Проверка таблицы маршрутов
```
ip r
```

```
sysctl -w net.ipv4.ip_forward=1
```
3. Установка По для маршрутизации
```
apt install iptables
```
```
apt install conntrack
```
```
nano gatenat.sh
```
```
iptables -t nat --flush
iptables -t nat -A POSTROUTING -o enp0s3 -s 192.168.10.0/24 -j MASQUERADE
conntrack -F
```
Запуск скрипта

```
chmod +x gatenat.sh
```
```
./gatenat.sh
```
Проверка

```
iptables-save
```
Настройка сохранения таблицы маршрутизации

1 вариант
```
iptables-save > /etc/iptables.rules
```
Изминенеи настроек 
```
# nano /etc/network/interfaces
```
добавление строчки в конец файла
```
pre-up iptables-restore < /etc/iptables.rules 
```

2 вариант

Устанавливаем пакет для загрузки настроек iptables
```
apt install iptables-persistent -y
Yes
Yes
```

